<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper>
<mapper namespace="com.mcnc.bizmob.web.domain.commonCode.mapper.CommonCodeMapper">
    
    <!-- 시퀀스 값을 가져오는 쿼리 -->
    <select id="selectNextCommonCodeId" resultType="String">
        SELECT 'CODE_' || LPAD(HP_COMMON_CODE_SEQ.NEXTVAL, 8, '0') 
        FROM DUAL
    </select>
        
    <select id="selectCodeIdByBoardType" parameterType="String" resultType="CommonCodeDto">
    	SELECT
			CODE_ID 		AS codeId
			, CODE_NAME 	AS codeName
			, CODE_TYPE 	AS codeType
			, PARENT_CODE_ID AS parentCodeId
			, STATUS		AS status
			, CREATE_DATE 	AS createDate
			, CREATE_BY		AS createBy
			, DEFINE_TYPE	AS defineType
			, CODE_ALIAS	AS codeAlias
			, UPDATE_DATE	AS updateDate
    	FROM
    		HP_COMMON_CODE
    	WHERE
    		CODE_TYPE = #{boardType}
    </select>
    
		<select id="selectCommonCodeList" parameterType="String" resultType="CommonCodeDto">
		    SELECT 
		        c.CODE_ID         AS codeId,
		        c.CODE_NAME       AS codeName,
		        c.CODE_TYPE       AS codeType,
		        c.PARENT_CODE_ID  AS parentCodeId,
		        p.CODE_NAME       AS parentCodeName, 
		        c.STATUS          AS status,
		        c.CREATE_DATE     AS createDate,
		        c.CREATE_BY       AS createBy,
		        c.DEFINE_TYPE     AS defineType,
		        c.CODE_ALIAS      AS codeAlias,
		        c.UPDATE_DATE     AS updateDate
		    FROM 
		        HP_COMMON_CODE c
		        LEFT JOIN HP_COMMON_CODE p ON c.PARENT_CODE_ID = p.CODE_ID
		    WHERE 
		        c.DELETE_FLAG = 'N'
		        <if test="parentCodeId == null or parentCodeId == ''">
		            AND c.PARENT_CODE_ID IS NULL
		        </if>
		        <if test="parentCodeId != null and parentCodeId != ''">
		            AND c.PARENT_CODE_ID = #{parentCodeId} 
		        </if>
		</select>

    
     <select id="getBoardCategoryIds" parameterType="String" resultType="CommonCodeDto">
		SELECT 
			CODE_ID 		AS codeId
			, CODE_NAME 	AS codeName
			, CODE_TYPE 	AS codeType
			, PARENT_CODE_ID AS parentCodeId
			, STATUS		AS status
			, CREATE_DATE 	AS createDate
			, CREATE_BY		AS createBy
			, DEFINE_TYPE	AS defineType
			, CODE_ALIAS	AS codeAlias
			, UPDATE_DATE	AS updateDate
		FROM 
			HP_COMMON_CODE
		WHERE 
			DELETE_FLAG = 'N'
			<if test="parentCodeId == null or parentCodeId == ''">
				AND PARENT_CODE_ID IS NULL
			</if>
			<if test="parentCodeId != null and parentCodeId != ''">
			AND (PARENT_CODE_ID = #{parentCodeId}  OR CODE_ID = #{parentCodeId} )
			</if>
    </select>
    
    <select id="selectCommonCodeDetail" resultType="CommonCodeDto">
    	SELECT 
			CODE_ID 		AS codeId
			, CODE_NAME 	AS codeName
			, CODE_TYPE 	AS codeType
			, STATUS		AS status
			, CREATE_DATE 	AS createDate
			, CREATE_BY		AS createBy
			, DEFINE_TYPE	AS defineType
			, CODE_ALIAS	AS codeAlias
			, UPDATE_DATE	AS updateDate
		FROM 
			HP_COMMON_CODE	
		WHERE 
			DELETE_FLAG = 'N'
			AND CODE_ID = #{commonCodeId}
    </select>
    
    <insert id="insertCommonCode" parameterType="CommonCodeDto">
    	INSERT INTO HP_COMMON_CODE (
    		CODE_ID
    		<if test="parentCodeId != null and parentCodeId != ''">
	    		, PARENT_CODE_ID
    		</if>
    		, CODE_NAME
    		, STATUS
    		, DEFINE_TYPE
    		, CODE_ALIAS
    		, DELETE_FLAG
    		, CREATE_DATE
    		, CREATE_BY
    	) VALUES (
    		#{codeId}
    		<if test="parentCodeId != null and parentCodeId != ''">
	    		, #{parentCodeId}
	    	</if>
    		, #{codeName}
    		, #{status}
    		, 'USER'
    		, #{codeAlias , jdbcType=VARCHAR}
    		, 'N'
    		, SYSDATE
    		, #{createBy}
    	) 
    </insert>
    
    <update id="updateCommonCode" parameterType="CommonCodeDto">
    	UPDATE 
    		HP_COMMON_CODE
    	SET
    		CODE_NAME = #{codeName}
    		, STATUS = #{status}
    		, UPDATE_DATE = SYSDATE
    		, UPDATE_BY = #{updateBy}
    	WHERE
    		CODE_ID = #{codeId}
    </update>
    
    <delete id="deleteCommonCode" parameterType="String">
    	UPDATE 
    		HP_COMMON_CODE
    	SET
    		DELETE_FLAG = 'Y'
    		, UPDATE_DATE = SYSDATE
    	WHERE
    		CODE_ID = #{codeId}
    		OR PARENT_CODE_ID = #{codeId}
    </delete>
    
    <select id="selectPostLocationCodeId" parameterType="String" resultType="String">
    	SELECT
    		CODE_ID AS codeId
    	FROM
    		HP_COMMON_CODE
    	WHERE
    		CODE_TYPE = #{postLocation}
    </select>
	
    
    <select id="selectPostLocations" parameterType="String" resultType="PostLocationCommonCodeDto">
		SELECT 
			CODE_ID 		AS codeId
			, PARENT_CODE_ID AS parentCodeId
			, CODE_NAME 	AS codeName
			, CODE_TYPE 	AS isFieldEnabled
			, STATUS		AS status
			, CREATE_DATE 	AS createDate
			, CREATE_BY		AS createBy
			, DEFINE_TYPE	AS defineType
			, CODE_ALIAS	AS codeAlias
		FROM 
			HP_COMMON_CODE
		WHERE 
			DELETE_FLAG = 'N'
			<if test="parentCodeId == null or parentCodeId == ''">
				AND PARENT_CODE_ID IS NULL
			</if>
			<if test="parentCodeId != null and parentCodeId != ''">
				AND PARENT_CODE_ID = #{parentCodeId}
			</if>
    </select>
    
</mapper>
