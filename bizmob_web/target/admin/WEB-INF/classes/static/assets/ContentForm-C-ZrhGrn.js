import{d as he,ap as Q,aq as $,l as k,j as ee,s as ye,p as Be,n as T,k as be,_ as Fe,o as h,e as N,a,w as i,f as e,H as x,I as p,aj as te,ak as ve,al as le,M as L,U as y,g as A,h as V,c as D,a2 as U,a3 as Y,a4 as j,N as De,J as oe,ad as ae,ar as Ie,O as ke,P as xe}from"./index-C5K_s1wl.js";import{a as Ae}from"./useNetwork-BBZmMd-V.js";import{a as Ve}from"./utils-CFlAkpuO.js";import{B as we}from"./common-AUcBvRqL.js";import{u as Ee}from"./useCommonCode-DIzdSdac.js";import{L as Se}from"./LandingSelect-DityfkCS.js";const se=5,ne=1,P=2*1024*1024,Ne=he({__name:"ContentForm",props:Q({isForDetails:{type:Boolean,required:!0},displayFlag:{type:[String,null],required:!0},title:{type:String,required:!0},docId:{type:String},fileBanner:{type:Object,required:!0},contentBlocks:{type:Array,required:!0},pinFlag:{type:String,required:!0},landingLocationOpts:{type:Array,required:!0}},{parentCategoryId:{type:[String,null],required:!0},parentCategoryIdModifiers:{},subCategoryId:{type:[String,null],required:!0},subCategoryIdModifiers:{}}),emits:Q(["update:displayFlag","update:title","update:fileBanner","update:contentBlocks","update:pinFlag","afterInit"],["update:parentCategoryId","update:subCategoryId"]),setup(F,{expose:C,emit:b}){const t=F,f=b,B=$(F,"parentCategoryId"),o=$(F,"subCategoryId");let s=!1,d=!1;const{alert:r}=Ae(),{getBoardCategory:v}=Ee();function w(l){return l.fileName!==void 0}const R=k({get(){return t.pinFlag==="Y"},set(l){f("update:pinFlag",l?"Y":"N")}}),ie=k({get(){return t.displayFlag},set(l){f("update:displayFlag",l)}}),ue=k({get(){return t.title},set(l){f("update:title",l)}}),de=k(()=>Array.isArray(t.fileBanner.files)?t.fileBanner.files:[]),_=ee(),E=ee([]),M=k(()=>E.value.map(l=>({text:l.codeName,value:l.codeId}))),I=k(()=>{var n;const l=E.value.find(u=>u.codeId===B.value);return!l||!((n=l.subCommonCodeList)!=null&&n.length)?[]:l.subCommonCodeList.map(u=>({text:u.codeName,value:u.codeId}))}),z=()=>{s=!0,o.value="없음"},X=()=>{d=!0,B.value="없음"},H=async()=>{var n;const l=await v(we.HIPASSINFO);l&&(E.value=l.categoryList,await T(),t.isForDetails||(B.value=((n=M.value[0])==null?void 0:n.value)??null))},q=async l=>{var n,u;if(await T(),!!l){if(d=!1,s=!1,o.value&&I.value.findIndex(g=>g.value===o.value)<0){(n=I.value[0])!=null&&n.value?o.value=I.value[0].value:o.value=null;return}o.value||(o.value=((u=I.value[0])==null?void 0:u.value)??null)}},re=()=>{s=!1};ye(B,()=>{q(B.value)},{immediate:!0});const ce=()=>{const l={createDate:"",createBy:"",updateDate:null,updateBy:null,bodyDocId:"",metaDocId:"",orderNo:t.contentBlocks.length+1,contents:"",linkLabel:"",linkUrl:"",linkType:"",landing:{value:null,type:null},imageFiles:{files:[],deleteFiles:[]},deleteFlag:"N"};f("update:contentBlocks",[...t.contentBlocks,l])},Ce=l=>{const n=t.contentBlocks;n[l].deleteFlag="Y",f("update:contentBlocks",[...t.contentBlocks])},ge=l=>{const n=document.createElement("input");n.type="file",n.accept=".png, .jpg, .jpeg",n.multiple=!0,n.onchange=u=>G(l,u),n.click()},G=(l,n)=>{const u=n.target.files;if(!u||u.length===0)return;const g=[];for(const S of Array.from(u)){if(S.size>P){r("파일 1개당 용량 (2MB)이 초과되었습니다.");continue}g.push(S)}const c=[...t.contentBlocks];if(c[l].imageFiles?c[l].imageFiles.files||(c[l].imageFiles.files=[]):c[l].imageFiles={files:[],deleteFiles:[]},c[l].imageFiles.files.length+g.length>se){r("이미지는 최대 5개 등록가능합니다.");return}c[l].imageFiles.files=[...c[l].imageFiles.files,...g],f("update:contentBlocks",c)},me=(l,n)=>{const u=[...t.contentBlocks],g=u[l].imageFiles.files,c=u[l].imageFiles.deleteFiles||[];g[n]instanceof File||c.push(g[n]),g.splice(n,1),u[l].imageFiles.deleteFiles=c,f("update:contentBlocks",u)},O=()=>{f("update:fileBanner",be({files:t.fileBanner.files,deleteFiles:t.fileBanner.deleteFiles}))},pe=()=>{_.value&&_.value.click&&_.value.click()},fe=()=>{const l=t.fileBanner.files;if(!_.value||!_.value.files||!_.value.files.length)return;const n=Array.from(_.value.files);if(l.length+n.length>ne){r("이미지는 최대 1개 등록가능합니다.");return}for(const u of n){if(u.size>P){r("파일 1개당 용량 (2MB)이 초과되었습니다.");continue}for(let g=0;g<_.value.files.length;g++){const c=_.value.files.item(g);c&&!t.fileBanner.files.some(S=>S.name===c.name)&&t.fileBanner.files.length<5&&l.push(c)}}O(),_.value.value=""},_e=l=>{const n=t.fileBanner.files,u=t.fileBanner.deleteFiles;t.fileBanner.files[l]instanceof File||u.push(t.fileBanner.files[l]),n.splice(l,1),O()},J=async()=>{await Promise.all([H()])},W=()=>({category:d,subCategory:s}),Z=async()=>{await T(),!B.value||M.value.findIndex(l=>l.value===B.value)<0?(X(),z()):(!o.value||I.value.findIndex(l=>l.value===o.value)<0)&&z()};C({isCategoryNotExist:W,initCategory:Z}),Be(()=>{J().then(()=>{f("afterInit"),t.isForDetails||q(B.value)})});const K={props:t,emits:f,parentCategoryId:B,subCategoryId:o,get supCategoryIdNotExist(){return s},set supCategoryIdNotExist(l){s=l},get categoryIdNotExist(){return d},set categoryIdNotExist(l){d=l},alert:r,getBoardCategory:v,MAX_FILE_COUNT:se,MAX_FILE_BANNER_COUNT:ne,MAX_FILE_SIZE:P,isImageFile:w,pinFlag:R,displayFlag:ie,title:ue,normalizedFiles:de,inputFileBanner:_,categoryList:E,parentCategoryItems:M,subCategoryItems:I,setSupCategoryNotExist:z,setCategoryNotExist:X,getCategorySelection:H,onParentCategoryChange:q,onSubCategoryChange:re,addSection:ce,removeSection:Ce,selectFile:ge,onInputFile:G,onDeleteFile:me,emitUpdateFileBanner:O,selectFileBanner:pe,onInputFileBanner:fe,onDeleteFileBanner:_e,init:J,isCategoryNotExist:W,initCategory:Z,get toFileSize(){return Ve},LandingSelect:Se};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),m=F=>(ke("data-v-2122e100"),F=F(),xe(),F),Le={class:"form-table"},Ue=m(()=>e("colgroup",null,[e("col",{style:{width:"124px"}}),e("col"),e("col",{style:{width:"124px"}}),e("col")],-1)),je={class:"border-b-sm"},Me=m(()=>e("th",{class:"border-e-sm text-button font-weight-bold"},"카테고리",-1)),ze={class:"px-4 py-2",colspan:"7"},qe=m(()=>e("th",{class:"border-e-sm text-button font-weight-bold"},"노출여부",-1)),Oe={class:"px-4 py-2",colspan:"3"},Te={class:"border-b-sm"},Ye=m(()=>e("th",{class:"border-e-sm text-button font-weight-bold"},"제목",-1)),Pe={class:"px-4 py-2",colspan:"7"},Re=m(()=>e("th",{class:"border-e-sm text-button font-weight-bold"},"게시글ID",-1)),Xe={class:"px-4 py-2",colspan:"3"},He={class:"border-b-sm text-button font-weight-bold"},Ge=m(()=>e("th",{class:"border-e-sm"},"목록 배너 등록",-1)),Je={class:"px-4 py-2",colspan:"7"},We={class:"d-flex ga-6"},Ze=m(()=>e("input",{type:"text",hidden:""},null,-1)),Ke=m(()=>e("p",null,"최대 1개 가능. 파일 1개당 제한용량 2MB",-1)),Qe=m(()=>e("p",{class:"text-subtitle-1 font-weight-bold"},"000x000px로 등록 / jpg, png",-1)),$e={class:"d-flex align-center justify-space-between border-dashed border-0 border-b-thin"},et={class:"d-flex ga-2 text-body-2"},tt={class:"text-disabled"},lt=m(()=>e("th",{class:"border-e-sm"},"상단고정",-1)),ot={class:"px-4 py-2",colspan:"3"},at={class:"mt-2 font-weight-bold"},st={class:"form-table"},nt=m(()=>e("colgroup",null,[e("col",{style:{width:"124px"}}),e("col"),e("col",{style:{width:"124px"}}),e("col")],-1)),it={class:"border-b-sm text-button font-weight-bold"},ut={class:"border-e-sm"},dt={class:"px-4 py-2",colspan:"3"},rt={class:"d-flex align-end ga-6"},ct=m(()=>e("input",{type:"text",hidden:""},null,-1)),Ct=["onChange"],gt=m(()=>e("p",null,"최대 5개 가능. 파일 1개당 제한용량 2MB",-1)),mt={class:"text-subtitle-1 font-weight-bold"},pt={class:"text-primary"},ft={class:"d-flex align-center justify-space-between border-dashed border-0 border-b-thin"},_t={class:"d-flex ga-2 text-body-2"},ht={class:"text-disabled"},yt={class:"border-b-sm text-button font-weight-bold"},Bt={class:"border-e-sm text-button font-weight-bold"},bt={class:"px-4 py-2",colspan:"3"},Ft={class:"border-b-sm text-button font-weight-bold"},vt={class:"border-e-sm text-button font-weight-bold"},Dt={class:"px-4 py-2",colspan:"3"},It={class:"border-b-sm text-button font-weight-bold"},kt={class:"border-e-sm text-button font-weight-bold"},xt={class:"px-4 py-2",colspan:"3"};function At(F,C,b,t,f,B){return h(),N(U,null,[a(oe,{rounded:"lg",class:"overflow-hidden mt-4"},{default:i(()=>[e("table",Le,[Ue,e("tbody",null,[e("tr",je,[Me,e("td",ze,[a(x,{dense:""},{default:i(()=>[a(p,{cols:"6"},{default:i(()=>[a(te,{items:t.parentCategoryItems,density:"compact","item-title":"text","item-value":"value",modelValue:t.parentCategoryId,"onUpdate:modelValue":[C[0]||(C[0]=o=>t.parentCategoryId=o),t.onParentCategoryChange],"single-line":"",variant:"outlined","hide-details":"",disabled:b.isForDetails,placeholder:"선택"},null,8,["items","modelValue","disabled"])]),_:1}),a(p,{cols:"6"},{default:i(()=>[a(te,{items:t.subCategoryItems,density:"compact","item-title":"text","item-value":"value",modelValue:t.subCategoryId,"onUpdate:modelValue":[C[1]||(C[1]=o=>t.subCategoryId=o),t.onSubCategoryChange],"single-line":"",variant:"outlined","hide-details":"",placeholder:"선택"},null,8,["items","modelValue"])]),_:1})]),_:1})]),qe,e("td",Oe,[a(ve,{inline:"",modelValue:t.displayFlag,"onUpdate:modelValue":C[2]||(C[2]=o=>t.displayFlag=o),"hide-details":"auto"},{default:i(()=>[a(le,{label:"노출",value:"Y",class:"mr-4"}),a(le,{label:"미노출",value:"N"})]),_:1},8,["modelValue"])])]),e("tr",Te,[Ye,e("td",Pe,[a(L,{variant:"outlined",density:"compact",color:"primary","hide-details":"true",placeholder:"제목을 작성해주세요.",modelValue:t.title,"onUpdate:modelValue":C[3]||(C[3]=o=>t.title=o)},null,8,["modelValue"])]),Re,e("td",Xe,[e("label",null,y(b.docId?b.docId:"등록 후 생성"),1)])]),e("tr",He,[Ge,e("td",Je,[a(x,{dense:""},{default:i(()=>[a(p,{cols:"12",md:"8"},{default:i(()=>[e("div",We,[a(L,{readonly:"",variant:"outlined",color:"primary","hide-details":"true",placeholder:"파일을 선택하세요.",onClick:t.selectFileBanner}),Ze,e("input",{accept:".png, .jpg, .jpeg",type:"file",multiple:"",hidden:"",ref:"inputFileBanner",onChange:t.onInputFileBanner},null,544),a(A,{flat:"",color:"grey100",onClick:t.selectFileBanner},{default:i(()=>[V("파일선택")]),_:1}),Ke])]),_:1}),a(p,{cols:"12"},{default:i(()=>[Qe]),_:1}),b.fileBanner&&b.fileBanner.files.length?(h(),D(p,{key:0,cols:"12"},{default:i(()=>[a(x,{dense:""},{default:i(()=>[(h(!0),N(U,null,Y(t.normalizedFiles,(o,s)=>(h(),D(p,{cols:"12",md:"8",key:s,class:"pl-0 px-3"},{default:i(()=>[e("div",$e,[e("div",et,[e("p",null,y(t.isImageFile(o)?o.fileName:o.name),1),e("p",tt,y(t.isImageFile(o)?"":t.toFileSize(o.size||0)),1)]),a(A,{flat:"",onClick:d=>t.onDeleteFileBanner(s),icon:"mdi-close",size:"small"},null,8,["onClick"])])]),_:2},1024))),128))]),_:1})]),_:1})):j("",!0)]),_:1})]),lt,e("td",ot,[a(De,{modelValue:t.pinFlag,"onUpdate:modelValue":C[4]||(C[4]=o=>t.pinFlag=o),"hide-details":"",label:"상단고정"},null,8,["modelValue"])])])])])]),_:1}),(h(!0),N(U,null,Y(b.contentBlocks,(o,s)=>(h(),D(x,{class:"mt-2 mb-2 ml-1 mr-1",key:s},{default:i(()=>[a(p,{class:ae(["ga-2",{"hidden-section":o.deleteFlag==="Y"}])},{default:i(()=>[e("p",at,"내용 블럭 "+y(s+1),1)]),_:2},1032,["class"]),o.deleteFlag!=="Y"?(h(),D(p,{key:0,class:"d-flex justify-sm-end ga-2"},{default:i(()=>[s!==0?(h(),D(A,{key:0,flat:"",color:"grey100",onClick:d=>t.removeSection(s)},{default:i(()=>[V("이 블럭 삭제 -")]),_:2},1032,["onClick"])):j("",!0),a(A,{flat:"",color:"grey100",disabled:t.props.contentBlocks.length>s+1,onClick:C[5]||(C[5]=d=>t.addSection())},{default:i(()=>[V("블럭 추가 +")]),_:2},1032,["disabled"])]),_:2},1024)):j("",!0),a(oe,{rounded:"lg",class:ae(["overflow-hidden mt-4",{"hidden-section":o.deleteFlag==="Y"}])},{default:i(()=>[e("table",st,[nt,e("tbody",null,[e("tr",it,[e("th",ut,"이미지 파일 "+y(s===0?"":s+1),1),e("td",dt,[a(x,{dense:""},{default:i(()=>{var d;return[a(p,{cols:"12",md:"8"},{default:i(()=>[e("div",rt,[a(L,{readonly:"",variant:"outlined",color:"primary","hide-details":"true",placeholder:"파일을 선택하세요.",onClick:r=>t.selectFile(s)},null,8,["onClick"]),ct,e("input",{accept:".png, .jpg, .jpeg",type:"file",multiple:"",hidden:"",onChange:r=>t.onInputFile(s,r),ref_for:!0,ref:`inputFile-${s}`},null,40,Ct),a(A,{flat:"",color:"grey100",onClick:r=>t.selectFile(s)},{default:i(()=>[V("파일선택")]),_:2},1032,["onClick"]),gt])]),_:2},1024),a(p,{cols:"12"},{default:i(()=>{var r;return[e("p",mt,[V(" 이미지 파일 첨부 "),e("span",pt,y(o.imageFiles?(r=o.imageFiles.files)==null?void 0:r.length:0)+" 개 ",1)])]}),_:2},1024),o.imageFiles&&((d=o.imageFiles)!=null&&d.files)?(h(),D(p,{key:0,cols:"12"},{default:i(()=>[a(x,{dense:""},{default:i(()=>{var r;return[(h(!0),N(U,null,Y((r=o.imageFiles)==null?void 0:r.files,(v,w)=>(h(),D(p,{cols:"12",md:"8",key:w,class:"pl-0 px-3"},{default:i(()=>[e("div",ft,[e("div",_t,[e("p",null,y(t.isImageFile(v)?v.fileName:v.name),1),e("p",ht,y(t.isImageFile(v)?"":t.toFileSize(v.size||0)),1)]),a(A,{flat:"",onClick:R=>t.onDeleteFile(s,w),icon:"mdi-close",size:"small"},null,8,["onClick"])])]),_:2},1024))),128))]}),_:2},1024)]),_:2},1024)):j("",!0)]}),_:2},1024)])]),e("tr",yt,[e("th",Bt,"본문글 "+y(s===0?"":s+1),1),e("td",bt,[a(Ie,{placeholder:"내용을 작성하세요.",rows:"10",modelValue:o.contents,"onUpdate:modelValue":d=>o.contents=d,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])])]),e("tr",Ft,[e("th",vt,"링크 레이블 "+y(s===0?"":s+1),1),e("td",Dt,[a(L,{placeholder:"링크 URL을 적어주세요.",modelValue:o.linkLabel,"onUpdate:modelValue":d=>o.linkLabel=d,"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue"])])]),e("tr",It,[e("th",kt,"링크 위치 "+y(s===0?"":s+1),1),e("td",xt,[a(t.LandingSelect,{modelValue:o.landing,"onUpdate:modelValue":d=>o.landing=d,options:b.landingLocationOpts},null,8,["modelValue","onUpdate:modelValue","options"])])])])])]),_:2},1032,["class"])]),_:2},1024))),128))],64)}const Ut=Fe(Ne,[["render",At],["__scopeId","data-v-2122e100"],["__file","C:/workspace/hiplusWEB/smhiplus-mobile-admin-front/src/components/ContentForm/ContentForm.vue"]]);export{Ut as C};
